pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- game constants
local gravity = 0.3 -- acceleration due to gravity
local jump_speed = -4 -- upward speed when jumping
local player_radius = 4 -- radius of the main player

-- game state
local playery = 64 -- initial y position of the main player
local playeryspeed = 0 -- vertical speed of the main player
local game_over_flag = false

-- constants
local pillar_width = 8
local pillar_gap_min = 32
local pillar_gap_variation = 32
local pillar_speed = 1

-- variables
local pillars = {}
local pillars_on_screen = false
local score = -1

function game_over()
  game_over_flag = true
end

function check_collisions()
  for i, pillar in ipairs(pillars) do
    -- check collision with top pillar
    if player_radius > pillar.x and 0 - player_radius < pillar.x + pillar_width then
      if playery - player_radius < pillar.top_y or playery + player_radius > pillar.bottom_y then
        game_over()
        return
      end
    end
    
    -- check collision with bottom pillar
    if player_radius > pillar.x and 0 - player_radius < pillar.x + pillar_width then
      if playery + player_radius > pillar.bottom_y and playery - player_radius < pillar.bottom_y + pillar_height then
        game_over()
        return
      end
    end
  end
end

function spawn_pillars()
  score = score + 1
  local gap_size = max(pillar_gap_min, 2 * player_radius) + rnd(pillar_gap_variation)
  local pillar_top_y = 16 + player_radius + rnd(80 - gap_size - 2 * player_radius)
  local pillar_bottom_y = pillar_top_y + gap_size
  add(pillars, {x=128, top_y=pillar_top_y, bottom_y=pillar_bottom_y})
  pillars_on_screen = true
end

function move_pillars()
  for i,pillar in ipairs(pillars) do
    pillar.x = pillar.x - pillar_speed
  end
  if pillars[1].x + pillar_width < 0 then
    deli(pillars, 1)
    pillars_on_screen = false
  end
end

function draw_pillars()
  for i,pillar in ipairs(pillars) do
    rectfill(pillar.x, 0, pillar.x + pillar_width, pillar.top_y, 7)
    rectfill(pillar.x, pillar.bottom_y, pillar.x + pillar_width, 128, 7)
  end
end

function reset_game()
  if btnp(5) then -- 5 is the index for the "x" key
    playery = 64
    playeryspeed = 0
    pillars = {}
    pillars_on_screen = false
    score = -1
    game_over_flag = false
  end
end

function print_score()
  print(score, 112, 2, 11)
end

function _init()
  score = -1
  spawn_pillars()
end

function _update()
  check_collisions()

  if game_over_flag then
    reset_game()
    return
  end
  
  if not pillars_on_screen then
    spawn_pillars()
  end
  move_pillars()

  -- handle input
  if btnp(⬆️) then
    playeryspeed = jump_speed
  end

  -- update player position
  playery += playeryspeed
  playeryspeed += gravity

  -- constrain player to screen bounds
  if playery < player_radius then
    playery = player_radius
    playeryspeed = 0
  elseif playery > 128 - player_radius then
    playery = 128 - player_radius
    playeryspeed = 0
  end
end

function _draw()
  if game_over_flag then
    print("game over", (128-48)/2, 40, 8)
    print("press ❎ to restart", (128-96)/2, 52, 8)
    return
  end

  cls() -- clear the screen

  -- draw player
  circfill(player_radius, playery, player_radius, 12)

  draw_pillars()
  
  if score > -1 then
    print_score()
  end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
66606060660006006060666066606660666066606060660066000000000000000000666066000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06606600000000606600666066606600666066606660600000000000000000000000666060606600666066600000006066006660666066006660666066606000
60006060000006006060060060606060606066606000060000000000000000000000666060606060060060600000060060600600606060606060666060000600
60006060000060006060060066006060666060606600006000000000000000000000606066006060060066000000600060600600660060606660606066000060
60006060000006006060060060606060606060606000060000000000000000000000606060606060060060600000060060600600606060606060606060000600
06606660000000606660666060606060606060606660600000000000000000000000606060606660666060600000006066606660606060606060606066606000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06606600000000000000000000000000000000000000666006600000066006600000606066600000666000006600666066606660066066600660666060600000
60006060000000000000000000000000000000000000060060600000600060600000606060600000606000006060060060606000600006006060606060600000
60006060000000000000000000000000000000000000060060600000600060600000606066600000666000006060060066006600600006006060660066600000
60006060000000000000000000000000000000000000060060600000606060600000606060000000606000006060060060606000600006006060606000600000
06606660000006000600000000000000000000000000060066000000666066000000066060000000606000006660666060606660066006006600606066600000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60606660606006600660660066606660066000000000666006600000066060600660066006606660000066606060666066600660660006600000000000000000
60606000606060006060606060000600600000000000060060600000600060606060606060006000000060606060060006006060606060000000000000000000
66006600666060006060606066000600600000000000060060600000600066606060606066606600000066006060060006006060606066600000000000000000
60606000006060006060606060000600606000000000060060600000600060606060606000606000000060606060060006006060606000600000000000000000
60606660666006606600606060006660666000000000060066000000066060606600660066006660000066600660060006006600606066000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ee0eee0e0000ee0eee0eee000000000000000000000eee00ee00000eee0e0e0eee0e0000ee0eee0eee000000ee0eee0eee0eee0eee0eee0ee000ee0eee00ee0
e000e0e0e000e0e0e0e0e000000000000000000000000e00e0e00000e000e0e0e0e0e000e0e0e0e0e0000000e000e0e0e0e00e00e0e00e00e0e0e000e000e000
eee0eee0e000e0e0ee00ee00000000000000000000000e00e0e00000ee000e00eee0e000e0e0ee00ee000000e000eee0ee000e00ee000e00e0e0e000ee00eee0
00e0e000e000e0e0e0e0e000000000000000000000000e00e0e00000e000e0e0e000e000e0e0e0e0e0000000e000e0e0e0e00e00e0e00e00e0e0e0e0e00000e0
ee00e000eee0ee00e0e0eee0000000000000000000000e00ee000000eee0e0e0e000eee0ee00e0e0eee000000ee0e0e0e0e00e00e0e0eee0eee0eee0eee0ee00
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
60606660600066600000006066600660666066600660600000000000000000000000000000000000000000000000000000000000000000000000000000000000
60606000600060600000060006006060606006006000060000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606600600066600000600006006060666006006000006000000000000000000000000000000000000000000000000000000000000000000000000000000000
60606000600060000000060006006060600006006000060000000000000000000000000000000000000000000000000000000000000000000000000000000000
60606660666060000000006006006600600066600660600000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cc0ccc0c0c00000cc00ccc0ccc0ccc00000ccc0c0c0cc00ccc00cc000000cc0c0c00cc0ccc0ccc0ccc00000ccc0ccc0ccc0c0c00000c000c0c0ccc000000000
c000c000c0c00000c0c0c0c00c00c0c00000c0c0c0c0c0c00c00c0c00000c000c0c0c0000c00c000ccc00000ccc0c0c00c00c0c00000c000c0c0c0c000000000
c000cc000c000000c0c0ccc00c00ccc00000ccc0c0c0c0c00c00c0c00000ccc0ccc0ccc00c00cc00c0c00000c0c0ccc00c00ccc00000c000c0c0ccc000000000
c0c0c000c0c00000c0c0c0c00c00c0c00000c0c0c0c0c0c00c00c0c0000000c000c000c00c00c000c0c00000c0c0c0c00c00c0c00000c000c0c0c0c000000000
ccc0c000c0c00000ccc0c0c00c00c0c00000c0c00cc0ccc0ccc0cc000000cc00ccc0cc000c00ccc0c0c00000c0c0c0c00c00c0c00000ccc00cc0c0c000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777770000000000000000000000000000000000
66606660666006600660000066600660066000006660066000006660066006600660600066600000666066006660666006606660000060606660666060600000
60606060600060006000000060006000600000000600606000000600606060006000600060000000600060600600060060606060000060600600600060600000
66606600660066606660000066006660600000000600606000000600606060006000600066000000660060600600060060606600000060600600660060600000
60006060600000600060000060000060600000000600606000000600606060606060600060000000600060600600060060606060000066600600600066600000
60006060666066006600000066606600066000000600660000000600660066606660666066600000666066606660060066006060000006006660666066600000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606000666000006660660066606660666000006660066000006660066006600660600066600000666060606000600006600660666066606660660000000000
60606000060006006000606006006000606000000600606000000600606060006000600060000000600060606000600060006000606060006000606000000000
66606000060066606600606006006600660000000600606000000600606060006000600066000000660060606000600066606000660066006600606000000000
60606000060006006000606006006000606000000600606000000600606060606060600060000000600060606000600000606000606060006000606000000000
60606660060000006660606006006660606000000600660000000600660066606660666066600000600006606660666066000660606066606660606000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606000666000006660606000000660666000000660666066606000000006000000666006600000666066600660666006006060666066600000000000000000
60606000060006006000606000006060606000006000060060606000000060600000060060600000600060606000060060606060060006000000000000000000
66606000060066606600666000006060660000006000060066006000666060600000060060600000660066606660060060606060060006000000000000000000
60606000060006006000006000006060606000006000060060606000000066000000060060600000600060600060060066006060060006000000000000000000
60606660060000006000006000006600606000000660060060606660000006600000060066000000600060606600060006600660666006000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06606660666060000000666000600000006000000000666006600000666066006660606006606660000060600660600060606660666000000000000000000000
60000600606060000000666006000000060006000000060060600000606060600600606060000600000060606060600060606660600000000000000000000000
60000600660060006660606006006660060066600000060060600000666060600600606066600600000060606060600060606060660000000000000000000000
60000600606060000000606006000000060006000000060060600000606060600600606000600600000066606060600060606060600000000000000000000000
06600600606066600000606060000000600000000000060066000000606066606600066066000600000006006600666006606060666000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000777070707770077077707700070070707000777077707770700070700000000070707770700077707770777070700000777077707770770070700700
07000000700070700700700077707070700070707000707070707000700070700000000070707000700070707070707070700000707007007070707070700070
00700000770007000700700070707070700000007000777077007700700000000000000000007700700077707770777077700000770007007700707000000070
07000000700070700700700070707070700000007000707070707000700000000700000000007000700070707000700000700000707007007070707000000070
70000000777070700700077070707770070000007770707077707770777000007000000000007000777070707000700077700000777077707070777000000700
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000777070707770077077707770000077707000777077707770707000007070777077707000000000000000000000000000000000000000000000000000
07000000700070707070707070700700000070007000707070707070707000007070070077707000000000000000000000000000000000000000000000000000
00700000770007007770707077000700000077007000777077707770777000007770070070707000000000000000000000000000000000000000000000000000
07000000700070707000707070700700000070007000707070007000007000007070070070707000000000000000000000000000000000000000000000000000
70000000777070707000770070700700000070007770707070007000777007007070070070707770000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eee0e000eee0eee0eee0e0e00000eee00ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000e000e0e0e0e0e0e0e0e000000e00e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee00e000eee0eee0eee0eee000000e00eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000e000e0e0e000e00000e000000e0000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000eee0e0e0e000e000eee00e00ee00ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eee0e000eee0eee0eee0e0e00000e0e0eee0eee0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000e000e0e0e0e0e0e0e0e00000e0e00e00eee0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee00e000eee0eee0eee0eee00000eee00e00e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000e000e0e0e000e00000e00000e0e00e00e0e0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e000eee0e0e0e000e000eee00e00e0e00e00e0e0eee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000777070707770077077707700070070707000777077707770700070700000000070707770777007700770000077707000777077707770707070700700
07000000700070700700700077707070700070707000707070707000700070700000000070707070070070007070000070007000707070707070707070700070
00700000770007000700700070707070700000007000777077007700700000000000000000007770070070007070000077007000777077707770777000000070
07000000700070700700700070707070700000007000707070707000700000000700000000007000070070007070000070007000707070007000007000000070
70000000777070700700077070707770070000007770707077707770777000007000000000007000777007707700000070007770707070007000777000000700
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000100001005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001005010050000000000010050100500000000000130501305000000000001305013050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01424344

